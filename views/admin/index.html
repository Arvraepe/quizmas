<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quizmas - Admin - Scores</title>

    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.css" rel="stylesheet">
    <link href="../css/styles.css" rel="stylesheet">

</head>
<body>

    <div class="row">
        <ul class="nav nav-pills">
            <li role="presentation" class="active"><a href="#">Scores</a></li>
            <li role="presentation"><a href="rounds.html">Rondes</a></li>
            <li role="presentation"><a href="teams.html">Teams</a></li>
        </ul>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <h1>Quizmas: Scores</h1>
        </div>
    </div>

    <div id="scores-header">
        <span style="display: inline-block; width: 300px; margin-right: 8px;">Tafelnummer & groepsnaam</span>
    </div>
    <div id="scores-container">

    </div>

    <script src="../js/ramda.min.js"></script>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/fetch.js"></script>
    <script src="../js/quizmas.js"></script>
    <script>

        $(document).ready(function (){

            function update () {
                $('#scores-container').html();

                Quizmas.getEverything().then(function (everything) {

                    function stringSort (item1, item2) {
                        if ( item1.name < item2.name )
                            return -1;
                        if ( item1.name > item2.name )
                            return 1;
                        return 0;
                    }

                    everything.rounds.sort(stringSort).forEach(function (round) {
                        $('<span />', {
                            class: 'score-round-header',
                            html: `${round.name}`
                        }).appendTo('#scores-header');
                    });

                    everything.teams.sort(function (a, b){ return a.table - b.table; }).forEach(function (team) {
                        $('<div />', {
                            id: 'team-'+team.id,
                            html: `<span style="font-weight: bold; margin-right: 12px; width: 300px; display: inline-block">${team.table}: ${team.name}</span>`
                        }).appendTo('#scores-container');

                        everything.rounds.sort(stringSort).forEach(function (round) {

                            var scorePath = R.lensPath(['scores', team.id, round.id]);
                            var score = R.view(scorePath, everything) || 0;

                            $('<span />', {
                                id: 'team-'+team.id+'-round-'+round.id,
                                html: `<input class="score-input" id="score-${team.id}-${round.id}" type="text" value="${score}" />`
                            }).appendTo('#team-'+team.id);

                            $(`#score-${team.id}-${round.id}`).blur(function () {
                                Quizmas.updateTeamScore(team.id, round.id, $(this).val()).then(function () {
                                    console.log('done');
                                });
                            });

                        });

                    });



                });
            }

            update();
        });

    </script>
</body>
</html>